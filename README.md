# –ú—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–Ω—Ç—Ä–æ–ø–æ–º–æ—Ä—Ñ–Ω—ã–º —Ä–æ–±–æ—Ç–æ–º

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–Ω—Ç—Ä–æ–ø–æ–º–æ—Ä—Ñ–Ω—ã–º —Ä–æ–±–æ—Ç–æ–º –Ω–∞ ROS1. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GPT.

---

## üõ† –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. **–ë–∞–∑–æ–≤—ã–π –∞–≥–µ–Ω—Ç (`Agent.py`)**
- **–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –∞–≥–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç –∫–ª–∞—Å—Å–∞ `Agent`.
- **–ö–æ–Ω—Ñ–ª–∏–∫—Ç-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç**:  
  –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
  - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π** (—á–µ–º –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, —Ç–µ–º –≤–∞–∂–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ).
  - **–ò–µ—Ä–∞—Ä—Ö–∏–∏ –∞–≥–µ–Ω—Ç–æ–≤** (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∞–≥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –¥–æ—á–µ—Ä–Ω–∏—Ö).
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**:  
  –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –∞–≥–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –∑–∞–¥–∞–Ω–Ω–æ–º—É –¥–µ–π—Å—Ç–≤–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∑–∞ –ø–æ–∫–æ—è). 
  - **–§–∏–ª–ª–µ—Ä—ã**: –°–ª—É—á–∞–π–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –¥–æ–ª–≥–æ–º –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

#### –í—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∫–ª–∞—Å—Å–∞:

```mermaid
classDiagram
    class Agent {
        +str name
        +dict agent_operations
        +str current_operation
        +int current_operation_priority
        +Agent parent
        +list[Agent] children
        +float last_operation_time
        +float default_action_delay
        +bool is_default_operation_running
        +str default_operation
        +float default_operation_start
        +bool is_stopped
        +bool force_default_now
        +dict fillers
        +float filler_activation_time
        
        +setStoppedState(state: bool)
        +findChildByName(name: str) Agent
        +updateLastOperationTime()
        +addChild(agent: Agent)
        +addChildren(agent_list: list[Agent])
        #_setParent(parent_agent: Agent)
        +getCurrentPriority() int
        +getParentMaxPriority() int
        +getChildrenMaxPriority() int
        +doOperation(operation_name: str, override_priority: int, from_parent: bool, **kwargs)
        +registerOperation(operation_name: str, function_to_do, priority: int, cancel_function)
        +initOperationDefault(operation_name: str, **operation_kwargs)
        +addFiller(operation_name: str, **operation_kwargs)
        +cancelCurrentOperation()
        +cancelAllChildrenOperations()
        +cancelAllParentOperations()
        +checkForDefaultAction(event)
    }
```

#### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:

```mermaid
flowchart TD
    A[New operation received] --> B{Agent stopped?}
    B -- Yes --> C[Ignoring new agent operation]
    B -- No --> D{Operation from an ancestor?}

    D -- Yes --> E{Does the current operation have a higher priority?}
    D -- No --> F{Do ancestors have higher priority?} 

    F -- Yes --> C[Ignoring new agent operation]
    F -- No --> H[Undoing Ancestors' Operations]
    H --> E{Does the current operation have a higher priority?}
    
    E -- Yes --> C[Ignoring new agent operation]
    E -- No --> G{Do descendants have higher priority?}

    G -- Yes --> C[Ignoring new agent operation]
    G -- No --> I[Undoing Descendant Operations]
    I --> J[Starting a new agent operation]

    J --> N[End]
    C --> N[End]
```

### 2. **–î–∏—Å–ø–µ—Ç—á–µ—Ä (`Dispatcher.py`)**
- **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è**:  
  –£–ø—Ä–∞–≤–ª—è–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä —Ä–µ—á–∏ [SOL](!https://github.com/asanmalyshev/speak_out_loud) –∏ –ø–∞—Ä—Å–∏—Ç –º–µ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π.
- **–ú–µ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π**:  
  –§–æ—Ä–º–∞—Ç `<—Ç–∏–ø:–ø–∞—Ä–∞–º–µ—Ç—Ä_1;–ø–∞—Ä–∞–º–µ—Ç—Ä_n>`. –ü—Ä–∏–º–µ—Ä—ã:
  - –ü–æ–∑–∞: `<pose:left_arm;attention>`
  - –ê–Ω–∏–º–∞—Ü–∏—è: `<anim:right_arm;slow_splash;2>`
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**:  
  –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

#### –û–±—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ü–µ–ª–∏
```mermaid
flowchart LR
    A[Receive Goal] --> B[Init mentor agents]
    B --> C{Goal is dir?}
    C -- Yes --> D[Read last file]
    C -- No --> E[Speak by SoL]
    D --> E

    E --> F{Is SoL finished with success?}
    F -- No --> G[Server: set preempted]
    F -- Yes --> H{All agents priority < 2?}
    H -- No --> I[Wait for a high priority action to complete]
    H -- Yes --> J[Server: set succeeded]
```
### 3. **–ü—Ä–∏–º–µ—Ä –∞–≥–µ–Ω—Ç–∞ (`AgentLimb.py`)**
- **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç**:  
  –í–º–µ—Å—Ç–æ –æ—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–π –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 25% –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è).
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ROS**:  
  –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ActionLib –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∞–º–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ –∫–æ–Ω–µ—á–Ω–æ—Å—Ç–µ–π —Ä–æ–±–æ—Ç–∞.

### 4. **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (`CreateScenarioServer.py`)**
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:  
  –°–æ–∑–¥–∞–µ—Ç —Ç–µ–∫—Å—Ç—ã –¥–ª—è —Ä–æ–±–æ—Ç–∞-—ç–∫—Å–∫—É—Ä—Å–æ–≤–æ–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ GPT:
  - –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Å—Ç–∏–ª—å (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π/—à–∫–æ–ª—å–Ω—ã–π) –∏ –Ω–∞–ª–∏—á–∏–µ —é–º–æ—Ä–∞.
  - –†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ—Ç–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π.
- **–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**:  
```bash
multiagent_system
‚îú‚îÄ‚îÄ src/
‚îÇ ‚îú‚îÄ‚îÄ Dispatcher.py
‚îÇ ‚îú‚îÄ‚îÄ Agent.py
‚îÇ ‚îú‚îÄ‚îÄ AgentLimb.py
‚îÇ ‚îî‚îÄ‚îÄ CreateScenarioServer.py
‚îú‚îÄ‚îÄ config/
‚îÇ ‚îú‚îÄ‚îÄ full_description/  # –û–ø–∏—Å–∞–Ω–∏—è —ç–∫—Å–ø–æ–Ω–∞—Ç–æ–≤ (–Ω–∞–∑–≤–∞–Ω–∏–µ = –∏–º—è —Ñ–∞–π–ª–∞)
‚îÇ ‚îú‚îÄ‚îÄ prompt/ # –®–∞–±–ª–æ–Ω—ã –¥–ª—è GPT: —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏ –º–µ—Ç–∫–∏
‚îÇ ‚îî‚îÄ‚îÄ scenario/ # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (scenario_1.txt, ...), —Ä–∞–∑–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ –ø–∞–ø–∫–∞–º (–Ω–∞–∑–≤–∞–Ω–∏–µ = –∏–º—è –¥–∏—Ä—Ä–µ–∫—Ç–æ—Ä–∏–∏)
‚îú‚îÄ‚îÄ action/
‚îÇ ‚îú‚îÄ‚îÄ CreateScenario.action
‚îÇ ‚îî‚îÄ‚îÄ MultiAgentScenarioExecutor.action
‚îî‚îÄ‚îÄ README.md
```
#### –û–±—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ü–µ–ª–∏
```mermaid
flowchart LR
    A[Start creating scenario] --> B[Read Full Description, prompts, params]
    B --> C[Modify Reduce Prompt with params]
    C --> D[Send to GPT for Reduced Description]

    D --> E{Is Reduce Description Valid?}
    E -- Yes --> F[Read Action Labels Prompt]
    F --> G[Send to GPT for Scenario]

    G --> H{Is Scenario Valid?}
    H -- Yes --> I[Save new scenario]
    I --> J[Return True]

    H -- No --> N[Return False]
    E -- No --> O[Return False]
```

## üåü –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
- **–°–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**:  
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏, –≤—ã–∑–≤–∞–Ω–Ω—ã–µ ¬´–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è–º–∏¬ª GPT.
- **ROS-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**:  
–õ–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –ª—é–±–æ–≥–æ –∞–Ω—Ç—Ä–æ–ø–æ–º–æ—Ä—Ñ–Ω–æ–≥–æ —Ä–æ–±–æ—Ç–∞.
- **–ì–∏–±–∫–æ—Å—Ç—å**:  
- –ù–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `register_operation()`.
- –ò–µ—Ä–∞—Ä—Ö–∏—è –∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥–æ–º `add_children()`.
- **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**:  
–°–∏—Å—Ç–µ–º–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–æ–±–æ—Ç–∞-—ç–∫—Å–∫—É—Ä—Å–æ–≤–æ–¥–∞ –∏ —É—Å–ø–µ—à–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- `Agent.py` ‚Äî –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –∞–≥–µ–Ω—Ç–∞.
- `AgentLimb.py` ‚Äî –ø—Ä–∏–º–µ—Ä –∞–≥–µ–Ω—Ç–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω–µ—á–Ω–æ—Å—Ç—è–º–∏.
- `Dispatcher.py` ‚Äî –¥–∏—Å–ø–µ—Ç—á–µ—Ä –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥.
- `CreateScenarioServer.py` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
- `action/` ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–µ ROS-action —Ñ–∞–π–ª—ã.
- `config/` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
1. **–ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤**:
```bash
rosrun moc_multiagent_scenario create_scenario_action_server.py
```
2. **–ó–∞–ø—É—Å–∫ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞**:
```bash
rosrun moc_multiagent_scenario multiagent_dispatcher.py
```
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–æ–±–æ—Ç–æ–º:**:
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≥–µ–Ω—Ç—ã –ø–æ–¥ —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –≤–∞—à–µ–≥–æ —Ä–æ–±–æ—Ç–∞, —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–≤ –∏—Ö –æ—Ç Agent
- –í Dispatcher: —Å–æ–∑–¥–∞–π—Ç–µ –∏–µ—Ä–∞—Ä—Ö–∏—é, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–∏–ø –º–µ—Ç–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
- –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–∫ –≤ –ø—Ä–æ–º–ø—Ç

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è
–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö –≤—ã–ø—É—Å–∫–Ω–æ–π –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã.
–õ–∏—Ü–µ–Ω–∑–∏—è: MIT.

**–ê–≤—Ç–æ—Ä:** Moscovskaya, E.D.
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** [—Ä–µ–ø–æ](!https://github.com/moskovskayaliza2002)